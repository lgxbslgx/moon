<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Moon Manual</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Moon Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="moonbits-build-system-tutorial"><a class="header" href="#moonbits-build-system-tutorial">MoonBit's Build System Tutorial</a></h1>
<p>Moon is the build system for the MoonBit language, currently based on the <a href="https://github.com/evmar/n2">n2</a> project. Moon supports parallel and incremental builds. Additionally, moon also supports managing and building third-party packages on <a href="https://mooncakes.io/">mooncakes.io</a></p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>Before you begin with this tutorial, make sure you have installed the following:</p>
<ol>
<li>
<p><strong>MoonBit CLI Tools</strong>: Download it from the <a href="https://www.moonbitlang.com/download/">https://www.moonbitlang.com/download/</a>. This command line tool is needed for creating and managing MoonBit projects.</p>
<p>Use <code>moon help</code> to view the usage instructions.</p>
<pre><code class="language-bash">$ moon help
...
</code></pre>
</li>
<li>
<p><strong>MoonBit Language</strong> plugin in Visual Studio Code: You can install it from the VS Code marketplace. This plugin provides a rich development environment for MoonBit, including functionalities like syntax highlighting, code completion, and more.</p>
</li>
</ol>
<p>Once you have these prerequisites fulfilled, let's start by creating a new MoonBit module.</p>
<h2 id="creating-a-new-module"><a class="header" href="#creating-a-new-module">Creating a New Module</a></h2>
<p>To create a new module, enter the <code>moon new</code> command in the terminal, and you will see the module creation wizard. By using all the default values, you can create a new module named <code>username/hello</code> in the <code>my-project</code> directory.</p>
<pre><code class="language-bash">$ moon new
Enter the path to create the project (. for current directory): my-project
Select the create mode: exec
Enter your username: username
Enter your project name: hello
Enter your license: Apache-2.0
Created my-project
</code></pre>
<blockquote>
<p>If you want use all default values, you can use <code>moon new my-project</code> to create a new module named <code>username/hello</code> in the <code>my-project</code> directory.</p>
</blockquote>
<h2 id="understanding-the-module-directory-structure"><a class="header" href="#understanding-the-module-directory-structure">Understanding the Module Directory Structure</a></h2>
<p>After creating the new module, your directory structure should resemble the following:</p>
<pre><code class="language-bash">my-project
├── LICENSE
├── README.md
├── moon.mod.json
└── src
    ├── lib
    │   ├── hello.mbt
    │   ├── hello_test.mbt
    │   └── moon.pkg.json
    └── main
        ├── main.mbt
        └── moon.pkg.json
</code></pre>
<p>Here's a brief explanation of the directory structure:</p>
<ul>
<li>
<p><code>moon.mod.json</code> is used to identify a directory as a MoonBit module. It contains the module's metadata, such as the module name, version, etc. <code>source</code> specifies the source directory of the module. The default value is <code>src</code>.</p>
<pre><code class="language-json">{
  "name": "username/hello",
  "version": "0.1.0",
  "readme": "README.md",
  "repository": "",
  "license": "Apache-2.0",
  "keywords": [],
  "description": "",
  "source": "src"
}
</code></pre>
</li>
<li>
<p><code>lib</code> and <code>main</code> directories: These are the packages within the module. Each package can contain multiple <code>.mbt</code> files, which are the source code files for the MoonBit language. However, regardless of how many <code>.mbt</code> files a package has, they all share a common <code>moon.pkg.json</code> file. <code>lib/*_test.mbt</code> are separate test files in the <code>lib</code> package, these files are for blackbox test, so private members of the <code>lib</code> package cannot be accessed directly.</p>
</li>
<li>
<p><code>moon.pkg.json</code> is package descriptor. It defines the properties of the package, such as whether it is the main package and the packages it imports.</p>
<ul>
<li>
<p><code>main/moon.pkg.json</code>:</p>
<pre><code class="language-json">{
  "is_main": true,
  "import": [
    "username/hello/lib"
  ]
}
</code></pre>
</li>
</ul>
<p>Here, <code>"is_main: true"</code> declares that the package needs to be linked by the build system into a wasm file.</p>
<ul>
<li>
<p><code>lib/moon.pkg.json</code>:</p>
<pre><code class="language-json">{}
</code></pre>
</li>
</ul>
<p>This file is empty. Its purpose is simply to inform the build system that this folder is a package.</p>
</li>
</ul>
<h2 id="working-with-packages"><a class="header" href="#working-with-packages">Working with Packages</a></h2>
<p>Our <code>username/hello</code> module contains two packages: <code>username/hello/lib</code> and <code>username/hello/main</code>.</p>
<p>The <code>username/hello/lib</code> package contains <code>hello.mbt</code> and <code>hello_test.mbt</code> files:</p>
<p><code>hello.mbt</code></p>
<pre><code class="language-moonbit">pub fn hello() -&gt; String {
    "Hello, world!"
}
</code></pre>
<p><code>hello_test.mbt</code></p>
<pre><code class="language-moonbit">test "hello" {
  if @lib.hello() != "Hello, world!" {
    fail!("@lib.hello() != \"Hello, world!\"")
  }
}
</code></pre>
<p>The <code>username/hello/main</code> package contains a <code>main.mbt</code> file:</p>
<pre><code class="language-moonbit">fn main {
  println(@lib.hello())
}
</code></pre>
<p>To execute the program, specify the file system's path to the <code>username/hello/main</code> package in the <code>moon run</code> command:</p>
<pre><code class="language-bash">$ moon run ./src/main
Hello, world!
</code></pre>
<p>You can also omit <code>./</code></p>
<pre><code class="language-bash">$ moon run src/main
Hello, world!
</code></pre>
<p>You can test using the <code>moon test</code> command:</p>
<pre><code class="language-bash">$ moon test
Total tests: 1, passed: 1, failed: 0.
</code></pre>
<h2 id="package-importing"><a class="header" href="#package-importing">Package Importing</a></h2>
<p>In the MoonBit's build system, a module's name is used to reference its internal packages.
To import the <code>username/hello/lib</code> package in <code>src/main/main.mbt</code>, you need to specify it in <code>src/main/moon.pkg.json</code>:</p>
<pre><code class="language-json">{
  "is_main": true,
  "import": [
    "username/hello/lib"
  ]
}
</code></pre>
<p>Here, <code>username/hello/lib</code> specifies importing the <code>username/hello/lib</code> package from the <code>username/hello</code> module, so you can use <code>@lib.hello()</code> in <code>main/main.mbt</code>.</p>
<p>Note that the package name imported in <code>src/main/moon.pkg.json</code> is <code>username/hello/lib</code>, and <code>@lib</code> is used to refer to this package in <code>src/main/main.mbt</code>. The import here actually generates a default alias for the package name <code>username/hello/lib</code>. In the following sections, you will learn how to customize the alias for a package.</p>
<h2 id="creating-and-using-a-new-package"><a class="header" href="#creating-and-using-a-new-package">Creating and Using a New Package</a></h2>
<p>First, create a new directory named <code>fib</code> under <code>lib</code>:</p>
<pre><code class="language-bash">mkdir src/lib/fib
</code></pre>
<p>Now, you can create new files under <code>src/lib/fib</code>:</p>
<p><code>a.mbt</code>:</p>
<pre><code class="language-moonbit">pub fn fib(n : Int) -&gt; Int {
  match n {
    0 =&gt; 0
    1 =&gt; 1
    _ =&gt; fib(n - 1) + fib(n - 2)
  }
}
</code></pre>
<p><code>b.mbt</code>:</p>
<pre><code class="language-moonbit">pub fn fib2(num : Int) -&gt; Int {
  fn aux(n, acc1, acc2) {
    match n {
      0 =&gt; acc1
      1 =&gt; acc2
      _ =&gt; aux(n - 1, acc2, acc1 + acc2)
    }
  }

  aux(num, 0, 1)
}
</code></pre>
<p><code>moon.pkg.json</code>:</p>
<pre><code class="language-json">{}
</code></pre>
<p>After creating these files, your directory structure should look like this:</p>
<pre><code class="language-bash">my-project
├── LICENSE
├── README.md
├── moon.mod.json
└── src
    ├── lib
    │   ├── fib
    │   │   ├── a.mbt
    │   │   ├── b.mbt
    │   │   └── moon.pkg.json
    │   ├── hello.mbt
    │   ├── hello_test.mbt
    │   └── moon.pkg.json
    └── main
        ├── main.mbt
        └── moon.pkg.json
</code></pre>
<p>In the <code>src/main/moon.pkg.json</code> file, import the <code>username/hello/lib/fib</code> package and customize its alias to <code>my_awesome_fibonacci</code>:</p>
<pre><code class="language-json">{
  "is_main": true,
  "import": [
    "username/hello/lib",
    {
      "path": "username/hello/lib/fib",
      "alias": "my_awesome_fibonacci"
    }
  ]
}
</code></pre>
<p>This line imports the <code>fib</code> package, which is part of the <code>lib</code> package in the <code>hello</code> module. After doing this, you can use the <code>fib</code> package in <code>main/main.mbt</code>. Replace the file content of <code>main/main.mbt</code> to:</p>
<pre><code class="language-moonbit">fn main {
  let a = @my_awesome_fibonacci.fib(10)
  let b = @my_awesome_fibonacci.fib2(11)
  println("fib(10) = \{a}, fib(11) = \{b}")

  println(@lib.hello())
}
</code></pre>
<p>To execute your program, specify the path to the <code>main</code> package:</p>
<pre><code class="language-bash">$ moon run ./src/main
fib(10) = 55, fib(11) = 89
Hello, world!
</code></pre>
<h2 id="adding-tests"><a class="header" href="#adding-tests">Adding Tests</a></h2>
<p>Let's add some tests to verify our fib implementation. Add the following content in <code>src/lib/fib/a.mbt</code>:</p>
<p><code>src/lib/fib/a.mbt</code></p>
<pre><code class="language-moonbit">test {
  assert_eq!(fib(1), 1)
  assert_eq!(fib(2), 1)
  assert_eq!(fib(3), 2)
  assert_eq!(fib(4), 3)
  assert_eq!(fib(5), 5)
}
</code></pre>
<p>This code tests the first five terms of the Fibonacci sequence. <code>test { ... }</code> defines an inline test block. The code inside an inline test block is executed in test mode.</p>
<p>Inline test blocks are discarded in non-test compilation modes (<code>moon build</code> and <code>moon run</code>), so they won't cause the generated code size to bloat.</p>
<h2 id="stand-alone-test-files-for-blackbox-tests"><a class="header" href="#stand-alone-test-files-for-blackbox-tests">Stand-alone test files for blackbox tests</a></h2>
<p>Besides inline tests, MoonBit also supports stand-alone test files. Source files ending in <code>_test.mbt</code> are considered test files for blackbox tests. For example, inside the <code>src/lib/fib</code> directory, create a file named <code>fib_test.mbt</code> and paste the following code:</p>
<p><code>src/lib/fib/fib_test.mbt</code></p>
<pre><code class="language-moonbit">test {
  assert_eq!(@fib.fib(1), 1)
  assert_eq!(@fib.fib2(2), 1)
  assert_eq!(@fib.fib(3), 2)
  assert_eq!(@fib.fib2(4), 3)
  assert_eq!(@fib.fib(5), 5)
}
</code></pre>
<p>Notice that the test code uses <code>@fib</code> to refer to the <code>username/hello/lib/fib</code> package. The build system automatically creates a new package for blackbox tests by using the files that end with <code>_test.mbt</code>. This new package will import the current package automatically, allowing you to use <code>@lib</code> in the test code.</p>
<p>Finally, use the <code>moon test</code> command, which scans the entire project, identifies, and runs all inline tests as well as files ending with <code>_test.mbt</code>. If everything is normal, you will see:</p>
<pre><code class="language-bash">$ moon test
Total tests: 3, passed: 3, failed: 0.
$ moon test -v
test username/hello/lib/hello_test.mbt::hello ok
test username/hello/lib/fib/a.mbt::0 ok
test username/hello/lib/fib/fib_test.mbt::0 ok
Total tests: 3, passed: 3, failed: 0.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-help-for-moon"><a class="header" href="#command-line-help-for-moon">Command-Line Help for <code>moon</code></a></h1>
<p>This document contains the help content for the <code>moon</code> command-line program.</p>
<p><strong>Command Overview:</strong></p>
<ul>
<li><a href="commands.html#moon"><code>moon</code>↴</a></li>
<li><a href="commands.html#moon-new"><code>moon new</code>↴</a></li>
<li><a href="commands.html#moon-build"><code>moon build</code>↴</a></li>
<li><a href="commands.html#moon-check"><code>moon check</code>↴</a></li>
<li><a href="commands.html#moon-run"><code>moon run</code>↴</a></li>
<li><a href="commands.html#moon-test"><code>moon test</code>↴</a></li>
<li><a href="commands.html#moon-clean"><code>moon clean</code>↴</a></li>
<li><a href="commands.html#moon-fmt"><code>moon fmt</code>↴</a></li>
<li><a href="commands.html#moon-doc"><code>moon doc</code>↴</a></li>
<li><a href="commands.html#moon-info"><code>moon info</code>↴</a></li>
<li><a href="commands.html#moon-add"><code>moon add</code>↴</a></li>
<li><a href="commands.html#moon-remove"><code>moon remove</code>↴</a></li>
<li><a href="commands.html#moon-install"><code>moon install</code>↴</a></li>
<li><a href="commands.html#moon-tree"><code>moon tree</code>↴</a></li>
<li><a href="commands.html#moon-login"><code>moon login</code>↴</a></li>
<li><a href="commands.html#moon-register"><code>moon register</code>↴</a></li>
<li><a href="commands.html#moon-publish"><code>moon publish</code>↴</a></li>
<li><a href="commands.html#moon-package"><code>moon package</code>↴</a></li>
<li><a href="commands.html#moon-update"><code>moon update</code>↴</a></li>
<li><a href="commands.html#moon-coverage"><code>moon coverage</code>↴</a></li>
<li><a href="commands.html#moon-coverage-report"><code>moon coverage report</code>↴</a></li>
<li><a href="commands.html#moon-coverage-clean"><code>moon coverage clean</code>↴</a></li>
<li><a href="commands.html#moon-generate-build-matrix"><code>moon generate-build-matrix</code>↴</a></li>
<li><a href="commands.html#moon-upgrade"><code>moon upgrade</code>↴</a></li>
<li><a href="commands.html#moon-shell-completion"><code>moon shell-completion</code>↴</a></li>
<li><a href="commands.html#moon-version"><code>moon version</code>↴</a></li>
</ul>
<h2 id="moon"><a class="header" href="#moon"><code>moon</code></a></h2>
<p><strong>Usage:</strong> <code>moon &lt;COMMAND&gt;</code></p>
<h6 id="subcommands"><a class="header" href="#subcommands"><strong>Subcommands:</strong></a></h6>
<ul>
<li><code>new</code> — Create a new MoonBit module</li>
<li><code>build</code> — Build the current package</li>
<li><code>check</code> — Check the current package, but don't build object files</li>
<li><code>run</code> — Run a main package</li>
<li><code>test</code> — Test the current package</li>
<li><code>clean</code> — Remove the target directory</li>
<li><code>fmt</code> — Format source code</li>
<li><code>doc</code> — Generate documentation</li>
<li><code>info</code> — Generate public interface (<code>.mbti</code>) files for all packages in the module</li>
<li><code>add</code> — Add a dependency</li>
<li><code>remove</code> — Remove a dependency</li>
<li><code>install</code> — Install dependencies</li>
<li><code>tree</code> — Display the dependency tree</li>
<li><code>login</code> — Log in to your account</li>
<li><code>register</code> — Register an account at mooncakes.io</li>
<li><code>publish</code> — Publish the current module</li>
<li><code>package</code> — Package the current module</li>
<li><code>update</code> — Update the package registry index</li>
<li><code>coverage</code> — Code coverage utilities</li>
<li><code>generate-build-matrix</code> — Generate build matrix for benchmarking (legacy feature)</li>
<li><code>upgrade</code> — Upgrade toolchains</li>
<li><code>shell-completion</code> — Generate shell completion for bash/elvish/fish/pwsh/zsh to stdout</li>
<li><code>version</code> — Print version information and exit</li>
</ul>
<h2 id="moon-new"><a class="header" href="#moon-new"><code>moon new</code></a></h2>
<p>Create a new MoonBit module</p>
<p><strong>Usage:</strong> <code>moon new [OPTIONS] [PACKAGE_NAME]</code></p>
<h6 id="arguments"><a class="header" href="#arguments"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;PACKAGE_NAME&gt;</code> — The name of the package</li>
</ul>
<h6 id="options"><a class="header" href="#options"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--lib</code> — Create a library package instead of an executable</p>
</li>
<li>
<p><code>--path &lt;PATH&gt;</code> — Output path of the package</p>
</li>
<li>
<p><code>--user &lt;USER&gt;</code> — The user name of the package</p>
</li>
<li>
<p><code>--name &lt;NAME&gt;</code> — The name part of the package</p>
</li>
<li>
<p><code>--license &lt;LICENSE&gt;</code> — The license of the package</p>
<p>Default value: <code>Apache-2.0</code></p>
</li>
<li>
<p><code>--no-license</code> — Do not set a license for the package</p>
</li>
</ul>
<h2 id="moon-build"><a class="header" href="#moon-build"><code>moon build</code></a></h2>
<p>Build the current package</p>
<p><strong>Usage:</strong> <code>moon build [OPTIONS]</code></p>
<h6 id="options-1"><a class="header" href="#options-1"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--std</code> — Enable the standard library (default)</p>
</li>
<li>
<p><code>--nostd</code> — Disable the standard library</p>
</li>
<li>
<p><code>-g</code>, <code>--debug</code> — Emit debug information</p>
</li>
<li>
<p><code>--release</code> — Compile in release mode</p>
</li>
<li>
<p><code>--strip</code> — Enable stripping debug information</p>
</li>
<li>
<p><code>--no-strip</code> — Disable stripping debug information</p>
</li>
<li>
<p><code>--target &lt;TARGET&gt;</code> — Select output target</p>
<p>Possible values: <code>wasm</code>, <code>wasm-gc</code>, <code>js</code>, <code>native</code>, <code>all</code></p>
</li>
<li>
<p><code>--serial</code> — Handle the selected targets sequentially</p>
</li>
<li>
<p><code>--enable-coverage</code> — Enable coverage instrumentation</p>
</li>
<li>
<p><code>--sort-input</code> — Sort input files</p>
</li>
<li>
<p><code>--output-wat</code> — Output WAT instead of WASM</p>
</li>
<li>
<p><code>-d</code>, <code>--deny-warn</code> — Treat all warnings as errors</p>
</li>
<li>
<p><code>--no-render</code> — Don't render diagnostics from moonc (don't pass '-error-format json' to moonc)</p>
</li>
<li>
<p><code>--warn-list &lt;WARN_LIST&gt;</code> — Warn list config</p>
</li>
<li>
<p><code>--alert-list &lt;ALERT_LIST&gt;</code> — Alert list config</p>
</li>
<li>
<p><code>-j</code>, <code>--jobs &lt;JOBS&gt;</code> — Set the max number of jobs to run in parallel</p>
</li>
<li>
<p><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</p>
</li>
<li>
<p><code>-w</code>, <code>--watch</code> — Monitor the file system and automatically build artifacts</p>
</li>
</ul>
<h2 id="moon-check"><a class="header" href="#moon-check"><code>moon check</code></a></h2>
<p>Check the current package, but don't build object files</p>
<p><strong>Usage:</strong> <code>moon check [OPTIONS] [PACKAGE_PATH]</code></p>
<h6 id="arguments-1"><a class="header" href="#arguments-1"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;PACKAGE_PATH&gt;</code> — The package(and it's deps) to check</li>
</ul>
<h6 id="options-2"><a class="header" href="#options-2"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--std</code> — Enable the standard library (default)</p>
</li>
<li>
<p><code>--nostd</code> — Disable the standard library</p>
</li>
<li>
<p><code>-g</code>, <code>--debug</code> — Emit debug information</p>
</li>
<li>
<p><code>--release</code> — Compile in release mode</p>
</li>
<li>
<p><code>--strip</code> — Enable stripping debug information</p>
</li>
<li>
<p><code>--no-strip</code> — Disable stripping debug information</p>
</li>
<li>
<p><code>--target &lt;TARGET&gt;</code> — Select output target</p>
<p>Possible values: <code>wasm</code>, <code>wasm-gc</code>, <code>js</code>, <code>native</code>, <code>all</code></p>
</li>
<li>
<p><code>--serial</code> — Handle the selected targets sequentially</p>
</li>
<li>
<p><code>--enable-coverage</code> — Enable coverage instrumentation</p>
</li>
<li>
<p><code>--sort-input</code> — Sort input files</p>
</li>
<li>
<p><code>--output-wat</code> — Output WAT instead of WASM</p>
</li>
<li>
<p><code>-d</code>, <code>--deny-warn</code> — Treat all warnings as errors</p>
</li>
<li>
<p><code>--no-render</code> — Don't render diagnostics from moonc (don't pass '-error-format json' to moonc)</p>
</li>
<li>
<p><code>--warn-list &lt;WARN_LIST&gt;</code> — Warn list config</p>
</li>
<li>
<p><code>--alert-list &lt;ALERT_LIST&gt;</code> — Alert list config</p>
</li>
<li>
<p><code>-j</code>, <code>--jobs &lt;JOBS&gt;</code> — Set the max number of jobs to run in parallel</p>
</li>
<li>
<p><code>--output-json</code> — Output in json format</p>
</li>
<li>
<p><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</p>
</li>
<li>
<p><code>-w</code>, <code>--watch</code> — Monitor the file system and automatically check files</p>
</li>
<li>
<p><code>--patch-file &lt;PATCH_FILE&gt;</code> — The patch file to check, Only valid when checking specified package</p>
</li>
<li>
<p><code>--no-mi</code> — Whether to skip the mi generation, Only valid when checking specified package</p>
</li>
</ul>
<h2 id="moon-run"><a class="header" href="#moon-run"><code>moon run</code></a></h2>
<p>Run a main package</p>
<p><strong>Usage:</strong> <code>moon run [OPTIONS] &lt;PACKAGE_OR_MBT_FILE&gt; [ARGS]...</code></p>
<h6 id="arguments-2"><a class="header" href="#arguments-2"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;PACKAGE_OR_MBT_FILE&gt;</code> — The package or .mbt file to run</li>
<li><code>&lt;ARGS&gt;</code> — The arguments provided to the program to be run</li>
</ul>
<h6 id="options-3"><a class="header" href="#options-3"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--std</code> — Enable the standard library (default)</p>
</li>
<li>
<p><code>--nostd</code> — Disable the standard library</p>
</li>
<li>
<p><code>-g</code>, <code>--debug</code> — Emit debug information</p>
</li>
<li>
<p><code>--release</code> — Compile in release mode</p>
</li>
<li>
<p><code>--strip</code> — Enable stripping debug information</p>
</li>
<li>
<p><code>--no-strip</code> — Disable stripping debug information</p>
</li>
<li>
<p><code>--target &lt;TARGET&gt;</code> — Select output target</p>
<p>Possible values: <code>wasm</code>, <code>wasm-gc</code>, <code>js</code>, <code>native</code>, <code>all</code></p>
</li>
<li>
<p><code>--serial</code> — Handle the selected targets sequentially</p>
</li>
<li>
<p><code>--enable-coverage</code> — Enable coverage instrumentation</p>
</li>
<li>
<p><code>--sort-input</code> — Sort input files</p>
</li>
<li>
<p><code>--output-wat</code> — Output WAT instead of WASM</p>
</li>
<li>
<p><code>-d</code>, <code>--deny-warn</code> — Treat all warnings as errors</p>
</li>
<li>
<p><code>--no-render</code> — Don't render diagnostics from moonc (don't pass '-error-format json' to moonc)</p>
</li>
<li>
<p><code>--warn-list &lt;WARN_LIST&gt;</code> — Warn list config</p>
</li>
<li>
<p><code>--alert-list &lt;ALERT_LIST&gt;</code> — Alert list config</p>
</li>
<li>
<p><code>-j</code>, <code>--jobs &lt;JOBS&gt;</code> — Set the max number of jobs to run in parallel</p>
</li>
<li>
<p><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</p>
</li>
<li>
<p><code>--build-only</code> — Only build, do not run the code</p>
</li>
</ul>
<h2 id="moon-test"><a class="header" href="#moon-test"><code>moon test</code></a></h2>
<p>Test the current package</p>
<p><strong>Usage:</strong> <code>moon test [OPTIONS]</code></p>
<h6 id="options-4"><a class="header" href="#options-4"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--std</code> — Enable the standard library (default)</p>
</li>
<li>
<p><code>--nostd</code> — Disable the standard library</p>
</li>
<li>
<p><code>-g</code>, <code>--debug</code> — Emit debug information</p>
</li>
<li>
<p><code>--release</code> — Compile in release mode</p>
</li>
<li>
<p><code>--strip</code> — Enable stripping debug information</p>
</li>
<li>
<p><code>--no-strip</code> — Disable stripping debug information</p>
</li>
<li>
<p><code>--target &lt;TARGET&gt;</code> — Select output target</p>
<p>Possible values: <code>wasm</code>, <code>wasm-gc</code>, <code>js</code>, <code>native</code>, <code>all</code></p>
</li>
<li>
<p><code>--serial</code> — Handle the selected targets sequentially</p>
</li>
<li>
<p><code>--enable-coverage</code> — Enable coverage instrumentation</p>
</li>
<li>
<p><code>--sort-input</code> — Sort input files</p>
</li>
<li>
<p><code>--output-wat</code> — Output WAT instead of WASM</p>
</li>
<li>
<p><code>-d</code>, <code>--deny-warn</code> — Treat all warnings as errors</p>
</li>
<li>
<p><code>--no-render</code> — Don't render diagnostics from moonc (don't pass '-error-format json' to moonc)</p>
</li>
<li>
<p><code>--warn-list &lt;WARN_LIST&gt;</code> — Warn list config</p>
</li>
<li>
<p><code>--alert-list &lt;ALERT_LIST&gt;</code> — Alert list config</p>
</li>
<li>
<p><code>-j</code>, <code>--jobs &lt;JOBS&gt;</code> — Set the max number of jobs to run in parallel</p>
</li>
<li>
<p><code>-p</code>, <code>--package &lt;PACKAGE&gt;</code> — Run test in the specified package</p>
</li>
<li>
<p><code>-f</code>, <code>--file &lt;FILE&gt;</code> — Run test in the specified file. Only valid when <code>--package</code> is also specified</p>
</li>
<li>
<p><code>-i</code>, <code>--index &lt;INDEX&gt;</code> — Run only the index-th test in the file. Only valid when <code>--file</code> is also specified</p>
</li>
<li>
<p><code>-u</code>, <code>--update</code> — Update the test snapshot</p>
</li>
<li>
<p><code>-l</code>, <code>--limit &lt;LIMIT&gt;</code> — Limit of expect test update passes to run, in order to avoid infinite loops</p>
<p>Default value: <code>256</code></p>
</li>
<li>
<p><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</p>
</li>
<li>
<p><code>--build-only</code> — Only build, do not run the tests</p>
</li>
<li>
<p><code>--no-parallelize</code> — Run the tests in a target backend sequentially</p>
</li>
<li>
<p><code>--test-failure-json</code> — Print failure message in JSON format</p>
</li>
<li>
<p><code>--patch-file &lt;PATCH_FILE&gt;</code> — Path to the patch file</p>
</li>
<li>
<p><code>--doc</code> — Run doc test</p>
</li>
</ul>
<h2 id="moon-clean"><a class="header" href="#moon-clean"><code>moon clean</code></a></h2>
<p>Remove the target directory</p>
<p><strong>Usage:</strong> <code>moon clean</code></p>
<h2 id="moon-fmt"><a class="header" href="#moon-fmt"><code>moon fmt</code></a></h2>
<p>Format source code</p>
<p><strong>Usage:</strong> <code>moon fmt [OPTIONS] [ARGS]...</code></p>
<h6 id="arguments-3"><a class="header" href="#arguments-3"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;ARGS&gt;</code></li>
</ul>
<h6 id="options-5"><a class="header" href="#options-5"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--check</code> — Check only and don't change the source code</p>
</li>
<li>
<p><code>--sort-input</code> — Sort input files</p>
</li>
<li>
<p><code>--block-style &lt;BLOCK_STYLE&gt;</code> — Add separator between each segments</p>
<p>Possible values: <code>false</code>, <code>true</code></p>
</li>
</ul>
<h2 id="moon-doc"><a class="header" href="#moon-doc"><code>moon doc</code></a></h2>
<p>Generate documentation</p>
<p><strong>Usage:</strong> <code>moon doc [OPTIONS]</code></p>
<h6 id="options-6"><a class="header" href="#options-6"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--serve</code> — Start a web server to serve the documentation</p>
</li>
<li>
<p><code>-b</code>, <code>--bind &lt;BIND&gt;</code> — The address of the server</p>
<p>Default value: <code>127.0.0.1</code></p>
</li>
<li>
<p><code>-p</code>, <code>--port &lt;PORT&gt;</code> — The port of the server</p>
<p>Default value: <code>3000</code></p>
</li>
<li>
<p><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</p>
</li>
</ul>
<h2 id="moon-info"><a class="header" href="#moon-info"><code>moon info</code></a></h2>
<p>Generate public interface (<code>.mbti</code>) files for all packages in the module</p>
<p><strong>Usage:</strong> <code>moon info [OPTIONS]</code></p>
<h6 id="options-7"><a class="header" href="#options-7"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</p>
</li>
<li>
<p><code>--no-alias</code> — Do not use alias to shorten package names in the output</p>
</li>
<li>
<p><code>--target &lt;TARGET&gt;</code> — Select output target</p>
<p>Possible values: <code>wasm</code>, <code>wasm-gc</code>, <code>js</code>, <code>native</code>, <code>all</code></p>
</li>
</ul>
<h2 id="moon-add"><a class="header" href="#moon-add"><code>moon add</code></a></h2>
<p>Add a dependency</p>
<p><strong>Usage:</strong> <code>moon add [OPTIONS] &lt;PACKAGE_PATH&gt;</code></p>
<h6 id="arguments-4"><a class="header" href="#arguments-4"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;PACKAGE_PATH&gt;</code> — The package path to add</li>
</ul>
<h6 id="options-8"><a class="header" href="#options-8"><strong>Options:</strong></a></h6>
<ul>
<li><code>--bin</code> — Whether to add the dependency as a binary</li>
</ul>
<h2 id="moon-remove"><a class="header" href="#moon-remove"><code>moon remove</code></a></h2>
<p>Remove a dependency</p>
<p><strong>Usage:</strong> <code>moon remove &lt;PACKAGE_PATH&gt;</code></p>
<h6 id="arguments-5"><a class="header" href="#arguments-5"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;PACKAGE_PATH&gt;</code> — The package path to remove</li>
</ul>
<h2 id="moon-install"><a class="header" href="#moon-install"><code>moon install</code></a></h2>
<p>Install dependencies</p>
<p><strong>Usage:</strong> <code>moon install</code></p>
<h2 id="moon-tree"><a class="header" href="#moon-tree"><code>moon tree</code></a></h2>
<p>Display the dependency tree</p>
<p><strong>Usage:</strong> <code>moon tree</code></p>
<h2 id="moon-login"><a class="header" href="#moon-login"><code>moon login</code></a></h2>
<p>Log in to your account</p>
<p><strong>Usage:</strong> <code>moon login</code></p>
<h2 id="moon-register"><a class="header" href="#moon-register"><code>moon register</code></a></h2>
<p>Register an account at mooncakes.io</p>
<p><strong>Usage:</strong> <code>moon register</code></p>
<h2 id="moon-publish"><a class="header" href="#moon-publish"><code>moon publish</code></a></h2>
<p>Publish the current module</p>
<p><strong>Usage:</strong> <code>moon publish [OPTIONS]</code></p>
<h6 id="options-9"><a class="header" href="#options-9"><strong>Options:</strong></a></h6>
<ul>
<li><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</li>
</ul>
<h2 id="moon-package"><a class="header" href="#moon-package"><code>moon package</code></a></h2>
<p>Package the current module</p>
<p><strong>Usage:</strong> <code>moon package [OPTIONS]</code></p>
<h6 id="options-10"><a class="header" href="#options-10"><strong>Options:</strong></a></h6>
<ul>
<li><code>--frozen</code> — Do not sync dependencies, assuming local dependencies are up-to-date</li>
<li><code>--list</code></li>
</ul>
<h2 id="moon-update"><a class="header" href="#moon-update"><code>moon update</code></a></h2>
<p>Update the package registry index</p>
<p><strong>Usage:</strong> <code>moon update</code></p>
<h2 id="moon-coverage"><a class="header" href="#moon-coverage"><code>moon coverage</code></a></h2>
<p>Code coverage utilities</p>
<p><strong>Usage:</strong> <code>moon coverage &lt;COMMAND&gt;</code></p>
<h6 id="subcommands-1"><a class="header" href="#subcommands-1"><strong>Subcommands:</strong></a></h6>
<ul>
<li><code>report</code> — Generate code coverage report</li>
<li><code>clean</code> — Clean up coverage artifacts</li>
</ul>
<h2 id="moon-coverage-report"><a class="header" href="#moon-coverage-report"><code>moon coverage report</code></a></h2>
<p>Generate code coverage report</p>
<p><strong>Usage:</strong> <code>moon coverage report [args]... [COMMAND]</code></p>
<h6 id="arguments-6"><a class="header" href="#arguments-6"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;args&gt;</code> — Arguments to pass to the coverage utility</li>
</ul>
<h6 id="options-11"><a class="header" href="#options-11"><strong>Options:</strong></a></h6>
<ul>
<li><code>-h</code>, <code>--help</code> — Show help for the coverage utility</li>
</ul>
<h2 id="moon-coverage-clean"><a class="header" href="#moon-coverage-clean"><code>moon coverage clean</code></a></h2>
<p>Clean up coverage artifacts</p>
<p><strong>Usage:</strong> <code>moon coverage clean</code></p>
<h2 id="moon-generate-build-matrix"><a class="header" href="#moon-generate-build-matrix"><code>moon generate-build-matrix</code></a></h2>
<p>Generate build matrix for benchmarking (legacy feature)</p>
<p><strong>Usage:</strong> <code>moon generate-build-matrix [OPTIONS] --output-dir &lt;OUT_DIR&gt;</code></p>
<h6 id="options-12"><a class="header" href="#options-12"><strong>Options:</strong></a></h6>
<ul>
<li><code>-n &lt;NUMBER&gt;</code> — Set all of <code>drow</code>, <code>dcol</code>, <code>mrow</code>, <code>mcol</code> to the same value</li>
<li><code>--drow &lt;DIR_ROWS&gt;</code> — Number of directory rows</li>
<li><code>--dcol &lt;DIR_COLS&gt;</code> — Number of directory columns</li>
<li><code>--mrow &lt;MOD_ROWS&gt;</code> — Number of module rows</li>
<li><code>--mcol &lt;MOD_COLS&gt;</code> — Number of module columns</li>
<li><code>-o</code>, <code>--output-dir &lt;OUT_DIR&gt;</code> — The output directory</li>
</ul>
<h2 id="moon-upgrade"><a class="header" href="#moon-upgrade"><code>moon upgrade</code></a></h2>
<p>Upgrade toolchains</p>
<p><strong>Usage:</strong> <code>moon upgrade [OPTIONS]</code></p>
<h6 id="options-13"><a class="header" href="#options-13"><strong>Options:</strong></a></h6>
<ul>
<li><code>-f</code>, <code>--force</code> — Force upgrade</li>
</ul>
<h2 id="moon-shell-completion"><a class="header" href="#moon-shell-completion"><code>moon shell-completion</code></a></h2>
<p>Generate shell completion for bash/elvish/fish/pwsh/zsh to stdout</p>
<p><strong>Usage:</strong> <code>moon shell-completion [OPTIONS]</code></p>
<p>Discussion:
Enable tab completion for Bash, Elvish, Fish, Zsh, or PowerShell
The script is output on <code>stdout</code>, allowing one to re-direct the
output to the file of their choosing. Where you place the file
will depend on which shell, and which operating system you are
using. Your particular configuration may also determine where
these scripts need to be placed.</p>
<p>The completion scripts won't update itself, so you may need to
periodically run this command to get the latest completions.
Or you may put <code>eval "$(moon shell-completion --shell &lt;SHELL&gt;)"</code>
in your shell's rc file to always load newest completions on startup.
Although it's considered not as efficient as having the completions
script installed.</p>
<p>Here are some common set ups for the three supported shells under
Unix and similar operating systems (such as GNU/Linux).</p>
<p>Bash:</p>
<p>Completion files are commonly stored in <code>/etc/bash_completion.d/</code> for
system-wide commands, but can be stored in
<code>~/.local/share/bash-completion/completions</code> for user-specific commands.
Run the command:</p>
<pre><code>$ mkdir -p ~/.local/share/bash-completion/completions
$ moon shell-completion --shell bash &gt;&gt; ~/.local/share/bash-completion/completions/moon
</code></pre>
<p>This installs the completion script. You may have to log out and
log back in to your shell session for the changes to take effect.</p>
<p>Bash (macOS/Homebrew):</p>
<p>Homebrew stores bash completion files within the Homebrew directory.
With the <code>bash-completion</code> brew formula installed, run the command:</p>
<pre><code>$ mkdir -p $(brew --prefix)/etc/bash_completion.d
$ moon shell-completion --shell bash &gt; $(brew --prefix)/etc/bash_completion.d/moon.bash-completion
</code></pre>
<p>Fish:</p>
<p>Fish completion files are commonly stored in
<code>$HOME/.config/fish/completions</code>. Run the command:</p>
<pre><code>$ mkdir -p ~/.config/fish/completions
$ moon shell-completion --shell fish &gt; ~/.config/fish/completions/moon.fish
</code></pre>
<p>This installs the completion script. You may have to log out and
log back in to your shell session for the changes to take effect.</p>
<p>Elvish:</p>
<p>Elvish completions are commonly stored in a single <code>completers</code> module.
A typical module search path is <code>~/.config/elvish/lib</code>, and
running the command:</p>
<pre><code>$ moon shell-completion --shell elvish &gt;&gt; ~/.config/elvish/lib/completers.elv
</code></pre>
<p>will install the completions script. Note that use <code>&gt;&gt;</code> (append)
instead of <code>&gt;</code> (overwrite) to prevent overwriting the existing completions
for other commands. Then prepend your rc.elv with:</p>
<pre><code>`use completers`
</code></pre>
<p>to load the <code>completers</code> module and enable completions.</p>
<p>Zsh:</p>
<p>ZSH completions are commonly stored in any directory listed in
your <code>$fpath</code> variable. To use these completions, you must either
add the generated script to one of those directories, or add your
own to this list.</p>
<p>Adding a custom directory is often the safest bet if you are
unsure of which directory to use. First create the directory; for
this example we'll create a hidden directory inside our <code>$HOME</code>
directory:</p>
<pre><code>$ mkdir ~/.zfunc
</code></pre>
<p>Then add the following lines to your <code>.zshrc</code> just before
<code>compinit</code>:</p>
<pre><code>fpath+=~/.zfunc
</code></pre>
<p>Now you can install the completions script using the following
command:</p>
<pre><code>$ moon shell-completion --shell zsh &gt; ~/.zfunc/_moon
</code></pre>
<p>You must then open a new zsh session, or simply run</p>
<pre><code>$ . ~/.zshrc
</code></pre>
<p>for the new completions to take effect.</p>
<p>Custom locations:</p>
<p>Alternatively, you could save these files to the place of your
choosing, such as a custom directory inside your $HOME. Doing so
will require you to add the proper directives, such as <code>source</code>ing
inside your login script. Consult your shells documentation for
how to add such directives.</p>
<p>PowerShell:</p>
<p>The powershell completion scripts require PowerShell v5.0+ (which
comes with Windows 10, but can be downloaded separately for windows 7
or 8.1).</p>
<p>First, check if a profile has already been set</p>
<pre><code>PS C:\&gt; Test-Path $profile
</code></pre>
<p>If the above command returns <code>False</code> run the following</p>
<pre><code>PS C:\&gt; New-Item -path $profile -type file -force
</code></pre>
<p>Now open the file provided by <code>$profile</code> (if you used the
<code>New-Item</code> command it will be
<code>${env:USERPROFILE}\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1</code></p>
<p>Next, we either save the completions file into our profile, or
into a separate file and source it inside our profile. To save the
completions into our profile simply use</p>
<pre><code>PS C:\&gt; moon shell-completion --shell powershell &gt;&gt;
${env:USERPROFILE}\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1
</code></pre>
<p>This discussion is taken from <code>rustup completions</code> command with some changes.</p>
<h6 id="options-14"><a class="header" href="#options-14"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--shell &lt;SHELL&gt;</code> — The shell to generate completion for</p>
<p>Default value: <code>&lt;your shell&gt;</code></p>
<p>Possible values: <code>bash</code>, <code>elvish</code>, <code>fish</code>, <code>powershell</code>, <code>zsh</code></p>
</li>
</ul>
<h2 id="moon-version"><a class="header" href="#moon-version"><code>moon version</code></a></h2>
<p>Print version information and exit</p>
<p><strong>Usage:</strong> <code>moon version [OPTIONS]</code></p>
<h6 id="options-15"><a class="header" href="#options-15"><strong>Options:</strong></a></h6>
<ul>
<li><code>--all</code> — Print all version information</li>
<li><code>--json</code> — Print version information in JSON format</li>
<li><code>--no-path</code> — Do not print the path</li>
</ul>
<hr/>
<p><small><i>
This document was generated automatically by
<a href="https://crates.io/crates/clap-markdown"><code>clap-markdown</code></a>.
</i></small></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="module-configuration"><a class="header" href="#module-configuration">Module Configuration</a></h1>
<p>moon uses the <code>moon.mod.json</code> file to identify and describe a module.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="module-name"><a class="header" href="#module-name">Module Name</a></h1>
<p>The <code>name</code> field is used to specify the name of the module, and it is required.</p>
<pre><code class="language-json">{
  "name": "example",
  ...
}
</code></pre>
<p>The module name can contain letters, numbers, <code>_</code>, <code>-</code>, and <code>/</code>.</p>
<p>For modules published to <a href="https://mooncakes.io">mooncakes.io</a>, the module name must begin with the username. For example:</p>
<pre><code class="language-json">{
  "name": "moonbitlang/core",
  ...
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="version"><a class="header" href="#version">Version</a></h1>
<p>The <code>version</code> field is used to specify the version of the module.</p>
<p>This field is optional. For modules published to <a href="https://mooncakes.io">mooncakes.io</a>, the version number must follow the <a href="https://semver.org/spec/v2.0.0.html">Semantic Versioning 2.0.0</a> specification.</p>
<pre><code class="language-json">{
  "name": "example",
  "version": "0.1.0",
  ...
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deps"><a class="header" href="#deps">Deps</a></h1>
<p>The <code>deps</code> field is used to specify the dependencies of the module.</p>
<p>It is automatically managed by commands like <code>moon add</code> and <code>moon remove</code>.</p>
<pre><code class="language-json">{
  "name": "username/hello",
  "deps": {
    "moonbitlang/x": "0.4.6"
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="readme"><a class="header" href="#readme">README</a></h1>
<p>The <code>readme</code> field is used to specify the path to the module's README file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="repository"><a class="header" href="#repository">Repository</a></h1>
<p>The <code>repository</code> field is used to specify the URL of the module's repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="license"><a class="header" href="#license">License</a></h1>
<p>The <code>license</code> field is used to specify the license of the module. The license type must comply with the <a href="https://spdx.org/licenses/">SPDX License List</a>.</p>
<pre><code class="language-json">{
  "license": "MIT"
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keywords"><a class="header" href="#keywords">Keywords</a></h1>
<p>The <code>keywords</code> field is used to specify the keywords for the module.</p>
<pre><code class="language-json">{
  "keywords": ["example", "test"]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="description"><a class="header" href="#description">Description</a></h1>
<p>The <code>description</code> field is used to specify the description of the module.</p>
<pre><code class="language-json">{
  "description": "This is a description of the module."
}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="source-directory"><a class="header" href="#source-directory">Source directory</a></h1>
<p>The <code>source</code> field is used to specify the source directory of the module.</p>
<p>It must be a subdirectory of the directory where the <code>moon.mod.json</code> file is located and must be a relative path.</p>
<p>When creating a module using the <code>moon new</code> command, a <code>src</code> directory will be automatically generated, and the default value of the <code>source</code> field will be <code>src</code>.</p>
<pre><code class="language-json">{
  "source": "src"
}
</code></pre>
<p>When the <code>source</code> field does not exist, or its value is <code>null</code> or an empty string <code>""</code>, it is equivalent to setting <code>"source": "."</code>. This means that the source directory is the same as the directory where the <code>moon.mod.json</code> file is located.</p>
<pre><code class="language-json">{
  "source": null
}
{
  "source": ""
}
{
  "source": "."
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="warning-list"><a class="header" href="#warning-list">Warning List</a></h1>
<p>This is used to disable specific preset compiler warning numbers.</p>
<p>For example, in the following configuration, <code>-2</code> disables the warning number 2 (Unused variable).</p>
<pre><code class="language-json">{
  "warn-list": "-2",
}
</code></pre>
<p>You can use <code>moonc build-package -warn-help</code> to see the list of preset compiler warning numbers.</p>
<pre><code>$ moonc -v                      
v0.1.20240914+b541585d3

$ moonc build-package -warn-help
Available warnings: 
  1 Unused function.
  2 Unused variable.
  3 Unused type declaration.
  4 Redundant case in a pattern matching (unused match case).
  5 Unused function argument.
  6 Unused constructor.
  7 Unused module declaration.
  8 Unused struct field.
 10 Unused generic type variable.
 11 Partial pattern matching.
 12 Unreachable code.
 13 Unresolved type variable.
 14 Lowercase type name.
 15 Unused mutability.
 16 Parser inconsistency.
 18 Useless loop expression.
 19 Top-level declaration is not left aligned.
 20 Invalid pragma
 21 Some arguments of constructor are omitted in pattern.
 22 Ambiguous block.
 23 Useless try expression.
 24 Useless error type.
 26 Useless catch all.
  A all warnings
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alert-list"><a class="header" href="#alert-list">Alert List</a></h1>
<p>Disable user preset alerts.</p>
<pre><code class="language-json">{
  "alert-list": "-alert_1-alert_2"
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="package-configuration"><a class="header" href="#package-configuration">Package Configuration</a></h1>
<p>moon uses the <code>moon.pkg.json</code> file to identify and describe a package.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name"><a class="header" href="#name">Name</a></h1>
<p>The package name is not configurable; it is determined by the directory name of the package.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="is-main"><a class="header" href="#is-main">is-main</a></h1>
<p>The <code>is-main</code> field is used to specify whether a package needs to be linked into an executable file.</p>
<p>The output of the linking process depends on the backend. When this field is set to <code>true</code>:</p>
<ul>
<li>For the <code>wasm</code> and <code>wasm-gc</code> backends, a standalone WebAssembly module will be generated.</li>
<li>For the <code>js</code> backend, a standalone JavaScript file will be generated.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import"><a class="header" href="#import">import</a></h1>
<p>The <code>import</code> field is used to specify other packages that a package depends on.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-import"><a class="header" href="#test-import">test-import</a></h1>
<p>The <code>test-import</code> field is used to specify other packages that the black-box test package of this package depends on.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wbtest-import"><a class="header" href="#wbtest-import">wbtest-import</a></h1>
<p>The <code>wbtest-import</code> field is used to specify other packages that the white-box test package of this package depends on.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="link-options"><a class="header" href="#link-options">Link Options</a></h1>
<p>By default, moon only links packages where <code>is-main</code> is set to <code>true</code>. If you need to link other packages, you can specify this with the <code>link</code> option.</p>
<p>The <code>link</code> option is used to specify link options, and its value can be either a boolean or an object.</p>
<ul>
<li>
<p>When the <code>link</code> value is <code>true</code>, it indicates that the package should be linked. The output will vary depending on the backend specified during the build.</p>
<pre><code class="language-json">{
  "link": true
}
</code></pre>
</li>
<li>
<p>When the <code>link</code> value is an object, it indicates that the package should be linked, and you can specify link options. For detailed configuration, please refer to the subpage for the corresponding backend.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm-backend-link-options"><a class="header" href="#wasm-backend-link-options">wasm Backend Link Options</a></h1>
<h4 id="configurable-options"><a class="header" href="#configurable-options">Configurable Options</a></h4>
<ul>
<li>
<p>The <code>exports</code> option is used to specify the function names exported by the <code>wasm</code> backend.</p>
<p>For example, in the following configuration, the <code>hello</code> function from the current package is exported as the <code>hello</code> function in the <code>wasm</code> module, and the <code>foo</code> function is exported as the <code>bar</code> function in the <code>wasm</code> module. In the <code>wasm</code> host, the <code>hello</code> and <code>bar</code> functions can be called to invoke the <code>hello</code> and <code>foo</code> functions from the current package.</p>
<pre><code class="language-json">{
  "link": {
    "wasm": {
      "exports": [
        "hello",
        "foo:bar"
      ]
    }
  }
}
</code></pre>
</li>
<li>
<p>The <code>heap-start-address</code> option is used to specify the starting address of the linear memory that can be used when compiling to the <code>wasm</code> backend.</p>
<p>For example, the following configuration sets the starting address of the linear memory to 1024.</p>
<pre><code class="language-json">{
  "link": {
    "wasm": {
      "heap-start-address": 1024
    }
  }
}
</code></pre>
</li>
<li>
<p>The <code>import-memory</code> option is used to specify the linear memory imported by the <code>wasm</code> module.</p>
<p>For example, the following configuration specifies that the linear memory imported by the <code>wasm</code> module is the <code>memory</code> variable from the <code>env</code> module.</p>
<pre><code class="language-json">{
  "link": {
    "wasm": {
      "import-memory": {
        "module": "env",
        "name": "memory"
      }
    }
  }
}
</code></pre>
</li>
<li>
<p>The <code>export-memory-name</code> option is used to specify the name of the linear memory exported by the <code>wasm</code> module.</p>
<pre><code class="language-json">{
  "link": {
    "wasm": {
      "export-memory-name": "memory"
    }
  }
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm-gc-backend-link-options"><a class="header" href="#wasm-gc-backend-link-options">wasm-gc Backend Link Options</a></h1>
<p>The link options for the <code>wasm-gc</code> backend are similar to those for the <code>wasm</code> backend, except there is no <code>heap-start-address</code> option.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="js-backend-link-options"><a class="header" href="#js-backend-link-options">JS Backend Link Options</a></h1>
<h4 id="configurable-options-1"><a class="header" href="#configurable-options-1">Configurable Options</a></h4>
<ul>
<li>
<p>The <code>exports</code> option is used to specify the function names to export in the JavaScript module.</p>
<p>For example, in the following configuration, the <code>hello</code> function from the current package is exported as the <code>hello</code> function in the JavaScript module. In the JavaScript host, the <code>hello</code> function can be called to invoke the <code>hello</code> function from the current package.</p>
<pre><code class="language-json">{
  "link": {
    "js": {
      "exports": [
        "hello"
      ]
    }
  }
}
</code></pre>
</li>
<li>
<p>The <code>format</code> option is used to specify the output format of the JavaScript module.</p>
<p>The currently supported formats are:</p>
<ul>
<li><code>esm</code></li>
<li><code>cjs</code></li>
<li><code>iife</code></li>
</ul>
<p>For example, the following configuration sets the output format of the current package to ES Module.</p>
<pre><code class="language-json">{
  "link": {
    "js": {
      "format": "esm"
    }
  }
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="warning-list-1"><a class="header" href="#warning-list-1">Warning List</a></h1>
<p>This is used to disable specific preset compiler warning numbers.</p>
<p>For example, in the following configuration, <code>-2</code> disables the warning number 2 (Unused variable).</p>
<pre><code class="language-json">{
  "warn-list": "-2",
}
</code></pre>
<p>You can use <code>moonc build-package -warn-help</code> to see the list of preset compiler warning numbers.</p>
<pre><code>$ moonc -v                      
v0.1.20240914+b541585d3

$ moonc build-package -warn-help
Available warnings: 
  1 Unused function.
  2 Unused variable.
  3 Unused type declaration.
  4 Redundant case in a pattern matching (unused match case).
  5 Unused function argument.
  6 Unused constructor.
  7 Unused module declaration.
  8 Unused struct field.
 10 Unused generic type variable.
 11 Partial pattern matching.
 12 Unreachable code.
 13 Unresolved type variable.
 14 Lowercase type name.
 15 Unused mutability.
 16 Parser inconsistency.
 18 Useless loop expression.
 19 Top-level declaration is not left aligned.
 20 Invalid pragma
 21 Some arguments of constructor are omitted in pattern.
 22 Ambiguous block.
 23 Useless try expression.
 24 Useless error type.
 26 Useless catch all.
  A all warnings
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alert-list-1"><a class="header" href="#alert-list-1">Alert List</a></h1>
<p>Disable user preset alerts.</p>
<pre><code class="language-json">{
  "alert-list": "-alert_1-alert_2"
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditional-compilation"><a class="header" href="#conditional-compilation">Conditional Compilation</a></h1>
<p>The smallest unit of conditional compilation is a file.</p>
<p>In a conditional compilation expression, three logical operators are supported: <code>and</code>, <code>or</code>, and <code>not</code>, where the <code>or</code> operator can be omitted.</p>
<p>For example, <code>["or", "wasm", "wasm-gc"]</code> can be simplified to <code>["wasm", "wasm-gc"]</code>.</p>
<p>Conditions in the expression can be categorized into backends and optimization levels:</p>
<ul>
<li><strong>Backend conditions</strong>: <code>"wasm"</code>, <code>"wasm-gc"</code>, and <code>"js"</code></li>
<li><strong>Optimization level conditions</strong>: <code>"debug"</code> and <code>"release"</code></li>
</ul>
<p>Conditional expressions support nesting.</p>
<p>If a file is not listed in <code>"targets"</code>, it will be compiled under all conditions by default.</p>
<p>Example:</p>
<pre><code class="language-json">{
    "targets": {
        "only_js.mbt": ["js"],
        "only_wasm.mbt": ["wasm"],
        "only_wasm_gc.mbt": ["wasm-gc"],
        "all_wasm.mbt": ["wasm", "wasm-gc"],
        "not_js.mbt": ["not", "js"],
        "only_debug.mbt": ["debug"],
        "js_and_release.mbt": ["and", ["js"], ["release"]],
        "js_only_test.mbt": ["js"],
        "js_or_wasm.mbt": ["js", "wasm"],
        "wasm_release_or_js_debug.mbt": ["or", ["and", "wasm", "release"], ["and", "js", "debug"]]
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pre-build"><a class="header" href="#pre-build">Pre-build</a></h1>
<p>The <code>"pre-build"</code> field is used to specify pre-build commands, which will be executed before build commands such as <code>moon check|build|test</code>.</p>
<p><code>"pre-build"</code> is an array, where each element is an object containing <code>input</code>, <code>output</code>, and <code>command</code> fields. The <code>input</code> and <code>output</code> fields can be strings or arrays of strings, while the <code>command</code> field is a string. In the <code>command</code>, you can use any shell commands, as well as the <code>$input</code> and <code>$output</code> variables, which represent the input and output files, respectively. If these fields are arrays, they will be joined with spaces by default.</p>
<p>Currently, there is a built-in special command <code>:embed</code>, which converts files into MoonBit source code. The <code>--text</code> parameter is used to embed text files, and <code>--binary</code> is used for binary files. <code>--text</code> is the default and can be omitted. The <code>--name</code> parameter is used to specify the generated variable name, with <code>resource</code> being the default. The command is executed in the directory where the <code>moon.pkg.json</code> file is located.</p>
<pre><code class="language-json">{
  "pre-build": [
    {
      "input": "a.txt",
      "output": "a.mbt",
      "command": ":embed -i $input -o $output"
    }
  ]
}
</code></pre>
<p>If the content of <code>a.txt</code> in the current package directory is:</p>
<pre><code>hello,
world
</code></pre>
<p>After running <code>moon build</code>, the following <code>a.mbt</code> file will be generated in the directory where the <code>moon.pkg.json</code> is located:</p>
<pre><code>let resource : String =
  #|hello,
  #|world
  #|
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config-json-schema"><a class="header" href="#config-json-schema">Config JSON Schema</a></h1>
<h2 id="moonmodjson"><a class="header" href="#moonmodjson">moon.mod.json</a></h2>
<iframe src="source/mod_json_schema.html" width="100%" height="500px" frameborder="0"></iframe>
<h2 id="moonpkgjson"><a class="header" href="#moonpkgjson">moon.pkg.json</a></h2>
<iframe src="source/pkg_json_schema.html" width="100%" height="500px" frameborder="0"></iframe>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
